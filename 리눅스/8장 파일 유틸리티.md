# 8장 파일 유틸리티

### **파일**

저장 매체에 보관된 데이터 집합의 추상적 개념

저장, 읽기 등을 운영체제(커널)가 담당(관리, 처리)

<br>

## 파일 시스템

**파일을 어떻게 구동할 수 있는지**, 운영체제가 물리적 저장 장치의 파티션 안에 정보를 **저장하고 관리하기 위한 방법**, 자료구조 등의 체계

- 운영체제에 따라서 자신들 만의 파일 시스템 운영
- 파일 저장 방식은 파일 시스템에 따라 결정
- 하드디스크 포맷, 드라이브 설정하여 파일 저장 가능
- 물리적 저장 장치 : 하드디스크, CD-ROM, 플래시 메모리, 램 등

![Untitled](https://user-images.githubusercontent.com/101644572/173364326-45f77b2e-608c-4915-8b11-bba5567b9d79.png)


**리눅스의 표준 파일 시스템**

- ext, ext2, ext3, ext4 순서대로 발전 → 커널 2.4.x 이후부터 ext3, ext4, JFS, XFS 등과 같은 새로운 **저널링 파일 시스템** 추가

<br>

### 저널링 파일 시스템 - 비휘발성 파일 시스템에 속함

- 데이터베이스에서 사용하는 **저널링 기술** 적용
- 일정 부분을 기록하여, 백업 및 복구 능력이 뛰어난 파일 시스템 → 파일이 깨져도 빠른 복구
- 비정상적 종료로 인해 실행되는 파일시스템 복구 시간 단축(중간 중간 기록 하기 때문)
- ext3, ext4, JFFS2 등

<br>

### 휘발성 파일 시스템

- 전원 제거(종료) 시 사라짐
- 메모리 일부를 하드디스크처럼 사용 → 디스크가 없는 시스템에 유용
- 시스템 설치나 장애 복구에 유용하게 사용, gzip으로 압축
- 필요 시 메모리 할당, 크기 조정

<br>

### 특수 파일 시스템

- 실재하지 않는 파일 시스템 → 가상의 파일 시스템

<br>

## 리눅스 파일 시스템

### 루트 파일 시스템

- 리눅스는 **반드시** 루트 폴더를 가지고 있으며, 모든 폴더는 루트 폴더( / )를 기준으로 트리르 구성하여 배치한다.
- 다른 파일 시스템을 사용하여 루트 파일시스템의 한 폴더에 마운트 하여 사용할 수 있다.
- 필수 항목
    - 루트 폴더와 하위 폴더, 디바이스 파일, 라이브러리, 시스템 초기화 파일, 쉘, 쉘 유틸리티

<br>

### 가상 파일 시스템(VFS)

- 모든 파일시스템에 대한 공통 인터페이스를 제공
    - 모든 파일시스템을 표현할 수 있는 공통 파일(common file) 모델 도입
    - common file의 객체 유형 : 수퍼블록, 아이노드 ,파일객체, 디엔트리 객체
- 유닉스 파일 시스템과 관련된 모든 시스템 호출(시스템 콜)을 처리하는 커널 소프트웨어 계층
- VFS가 지원하는 파일 시스템
    - 디스크 기반 파일 시스템, 네트워크 기반 파일 시스템, 특수 파일 시스템

<br>

### VFS와 리눅스 파일 시스템

VFS와 리눅스 파일시스템은 루트 디렉터리를 기준으로 트리를 구성, 모든 파일시스템을 루트의 서브 디렉터리에 마운트하여 사용

<br>

### /proc 파일 시스템

- 실제로 존재하지 않는 가상 파일시스템
- 커널이 메모리에 저장한 것으로 디스크에 존재  하지 않음
- 주로 프로세스에 대한 제공 (하드웨어 정보도 알려줌) → process로 명명

<br>

## 파일 찾기, 필터링

### find 명령어

**$ find 디렉터리 [-옵션]**

- 지정된 디렉터리 아래의 모든 **파일 출력**
- 옵션 여러개 지정 가능

**$ find 디렉터리 -name 파일명 -print 또는 -ls**

- 해당하는 파일들을 모두 찾아 그 경로 출력
- -name 파일명 ← 이 부분이 옵션
- print 또는 ls를 입력 안할 시 print가 기본값

**$ find 디렉터리 [-옵션] -exec 명령어 {} \;**

- 옵션에 해당하는 파일들에 대해 명령어 실행

<br>

### grep 명령어

**$ grep [-옵션]  패턴  파일**

- 파일들을 대상으로 지정된 **문자열 검색**, 해당 문자열을 포함하는 줄 출력
- 옵션
    - -i : 대소문자를 무시하고 검색
    - -l : 해당 패턴이 들어있는 파일명 출력
    - -n : 줄번호도 함께 출력
    - -v : 명시된 패턴을 포함하지 않는 줄 출력
    - -c : 패턴과 일치하는 줄 수 출력
    - -w : 패턴이 하나의 단어로 된 것만 출력
- ls -l | grep 패턴 ← 파이프와 함께 사용 가능

<br>

### 문자열 정규식

![Untitled 1](https://user-images.githubusercontent.com/101644572/173364291-b3035656-0bbf-4bc4-b484-b4fea17c8b97.png)


<br>

## 파일 정렬

### sort 명령어

**$ sort [-옵션] 파일**

텍스트 파일들의 내용을 줄 단위로 정렬, 옵션에 따라 다양한 형태로 정렬

- 옵션 지정 안할 시 **정렬 필드를 기준으로** 오름차순으로 정렬
- 정렬 필드 지정
    - -**k 필드번호** : 필드번호에 해당하는 필드를 기준으로 정렬, 필드번호는 1부터 시작
    - **+시작필드 -종료필드** : 시작필드부터 종료필드 -1까지의 필드들을 기준으로 정렬, 필드번호는 0부터 시작
- 옵션
    - -r : 내림차순으로 정렬
    - -f : 대소문자를 구분안하고 정렬
    - -c : 정렬이 되지 않은 상태로 출력
    - -n : 숫자 문자열의 숫자 값에 따라 정렬
    - -t 문자 : 지정된 문자를 필드 구분자로 사용, 원래는 공백
- 출력 파일 옵션 -o
    - 정렬된 내용을 파일에 저장할 수 있다.
    - ex) $ sort -o sort.txt you.txt : you.txt의 정렬 내용을 sort.txt에 저장한다.

ex) $ sort -t: -k 3 -n -o passwd.txt /etc/passwd

- /etc/passwd파일의 필드 구분자를 :로, 3번째 필드에 숫자 문자열의 숫자 값의 따라 정렬한 것을 passwd.txt에 저장

<br>

## 파일 비교

### cmp 명령어

**$ cmp 파일1 파일2 :** 파일1과 파일2가 같은지 비교

- 두 파일이 같으면 출력 없음
- 두 파일이 다르면 서로 달라지는 위치 출력\

<br>

### diff 명령어

**$ diff [-i] 파일1 파일2**

- 파일1과 파일2를 줄 단위로 비교하여 차이점 출력, -i 옵션은 대소문자 무시 비교
- a : 추가, d : 삭제,  c : 변경,  < : 파일1에 있는 내용,  > : 파일2에 있는 내용
    - ex) 9a10, 13 = 파일1의 9번째 줄 이후로 파일2의 10~13번째 줄을 추가하면 서로 같다는 소리
    - ex) 10,13d9 = 두 파일이 9번째 줄까지는 같으며, 파일1의 10~13번째 줄을 삭제하면 파일2와 같아짐
    - ex) 3c3 = 파일1의 3번째 줄을 파일2의 3번째 줄로 변경하면 서로 같아짐

<br>

## 기타 파일 조작

### 파일 합병

**$ cat 파일1 파일2 > 파일3**

- 파일1과 파일2의 내용을 붙여서 새로운 파일 3 생성

**$ paste [-s] [-d 구분문자] 파일**

- 여러 파일들을 **줄 단위로 합병**하여 하나의 파일을 생성, 줄과 줄 사이는 탭으로 구분
- -s : 줄 단위 구분이 아닌 파일 끝에 다음 파일 내용을 덧붙인다.
- paste 파일1 파일2 > 파일3 으로 덧붙인걸 파일3에 저장 가능.

<br>

### 파일 분할

**$ split [-l n] 입력파일 [출력파일]**

- 하나의 입력 파일을 여러 개의 작은 파일로 분할
- -l n 옵션으로 n줄로 분할할지 지정 가능, 옵션 사용 안할 시 기본 1000줄
- 출력 파일명에 aa 부터 zz까지 첨자 붙음
    - 출력파일 지정 안할 시 xaa, xab 형태의 파일명으로 저장
